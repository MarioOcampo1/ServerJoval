<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" <!-- Datatable
    -->
  <title>Interferencias</title>
</head>

<body>
  <%- include('./partials/menusuperior.ejs')%>
  <%if (results){%>
    <h1 class="text-center">Interferencias</h1>
    <div class="table-responsive-sm">
      <table id="Interferencias" class="table table-hover table-sm table-bordered " style="width: 95%">
        <thead>
          <tr>
            <th class="text-center" scope="col">
              Nombre
            </th>
            <th class="text-center" scope="col">
              NÂ° de carpeta
            </th>
            <th class="text-center">
              Telefonica 
            </th>
            <th class="text-center">

              Agua
            </th>
            <th class="text-center">

              Cloacas
            </th>
            <th class="text-center">
              Electricidad
            </th>
            <th class="text-center">
              Claro
            </th>
            <th class="text-center">

              Arnet
            </th>
            <th class="text-center">
              Arsat
            </th>
            <th class="text-center">
              Telecom
            </th>

          </tr>
        </thead>
        <tbody>
        </tbody>

      </table>
    </div>
    <script type="text/javascript" language="javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" language="javascript" charset="utf8"
      src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
    <script type="text/javascript" language="javascript"
      src="//cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"></script>
    <!-- Moment.js: -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.4/moment.min.js"></script>
    <!-- Locales for moment.js-->
    <script src="//cdn.datatables.net/plug-ins/1.11.3/sorting/datetime-moment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.4/locale/es.js"></script>

    <script>
      $(document).ready(function () {
        $('#Interferencias thead tr')
          .clone(true)
          .addClass('filters')
          .appendTo('#Interferencias thead');
        var url = '/interferencias/info';
        tabla = $('#Interferencias').DataTable({
          orderCellsTop: true,
          fixedHeader: true,
          initComplete: function () {
            var api = this.api();
            // For each column
            api
              .columns()
              .eq(0)
              .each(function (colIdx) {
                // Set the header cell to contain the input element
                var cell = $('.filters th').eq(
                  $(api.column(colIdx).header()).index()
                );
                var title = $(cell).text();
                // $(cell).html('<input type="text" size="2" placeholder="'+ title + '" />');
                $(cell).html('<input type="text" size="2" placeholder="Buscar" />');

                // On every keypress in this input
                $(
                  'input',
                  $('.filters th').eq($(api.column(colIdx).header()).index())
                )
                  .off('keyup change')
                  .on('keyup change', function (e) {
                    e.stopPropagation();

                    // Get the search value
                    $(this).attr('title', $(this).val());
                    var regexr = '({search})'; //$(this).parents('th').find('select').val();

                    var cursorPosition = this.selectionStart;
                    // Search the column for that value
                    api
                      .column(colIdx)
                      .search(
                        this.value != ''
                          ? regexr.replace('{search}', '(((' + this.value + ')))')
                          : '',
                        this.value != '',
                        this.value == ''
                      )
                      .draw();

                    $(this)
                      .focus()[0]
                      .setSelectionRange(cursorPosition, cursorPosition);
                  });
              });
          },
          "language": { url: "//cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json" },
          "ajax": {
            "url": url,
            "dataSrc": "",
          },
          "columns": [
            {
              "data": "Nombre", render: function (data, type, row) {
                return '<a href="/editarTareas/' + row.id + '" class="btn  btn-outline-secondary btn-sm">' + row.Nombre + '</a>'
              }
            },
            {
              "data": "NCarpeta", render: function (data, type, row) {
                return '<a href="/editarTareas/' + row.id + '" class="btn btn-outline btn-sm">' + row.NCarpeta + '</a>'
              }
            },
            { "data": "intTelefonica", render: function(data,type,row){
              return 'Estado: '+row.intTelefonica + '. Vencimiento: '+moment(row.intTelefonicaObtenida).format("d-MM-YY")+''
            } },
            { "data": "intAgua", render: function(data,type,row){
              const fechaHoy = new Date();
              if(row.intAguaObtenida < fechaHoy){
                if(row.intAguaObtenida==null || row.intAguaObtenida=='' ){
  return 'Estado: '+row.intAgua }
else{
  return 'Estado: '+row.intAgua + '. Vencimiento: '+moment(row.intAguaObtenida).format("d-MM-YY")+'' };
}else{
  if(row.intAguaObtenida==null || row.intAguaObtenida=='' ){
  return 'Estado: '+row.intAgua }
else{
  return 'Estado: '+row.intAgua + '. Vencimiento: '+moment(row.intAguaObtenida).format("d-MM-YY")+'' };
}
}
              }
},
            { "data": "intCloaca", render: function(data,type,row){
              if(row.intCloacaObtenida==null || row.intCloacaObtenida=='' ){
  return 'Estado: '+row.intCloaca }
else{
  return 'Estado: '+row.intCloaca + '. Vencimiento: '+moment(row.intCloacaObtenida).format("d-MM-YY")+'' };
}},
            { "data": "intElectricidad", render: function(data,type,row){
              if(row.intElectricidadObtenida==null || row.intElectricidadObtenida=='' ){
  return 'Estado: '+row.intElectricidad }
else{
  return 'Estado: '+row.intElectricidad + '. Vencimiento: '+moment(row.intElectricidadObtenida).format("d-MM-YY")+'' };
}},
            { "data": "intClaro", render: function(data,type,row){
              if(row.intClaroObtenida==null || row.intClaroObtenida=='' ){
  return 'Estado: '+row.intClaro }
else{
  return 'Estado: '+row.intClaro + '. Vencimiento: '+moment(row.intClaroObtenida).format("d-MM-YY")+'' };
}},
            { "data": "intArnet", render: function(data,type,row){
              if(row.intArnetObtenida==null || row.intArnetObtenida=='' ){
  return 'Estado: '+row.intArnet }
else{
  return 'Estado: '+row.intArnet + '. Vencimiento: '+moment(row.intArnetObtenida).format("d-MM-YY")+'' };
}},
            { "data": "intArsat" , render: function(data,type,row){
              if(row.intArsatObtenida==null || row.intArsatObtenida=='' ){
  return 'Estado: '+row.intArsat }
else{
  return 'Estado: '+row.intArsat + '. Vencimiento: '+moment(row.intArsatObtenida).format("d-MM-YY")+'' };
}},
            { "data": "intTelecom", render: function(data,type,row){
              if(row.intTelecomObtenida==null || row.intTelecomObtenida=='' ){
  return 'Estado: '+row.intTelecom }
else{
  return 'Estado: '+row.intTelecom + '. Vencimiento: '+moment(row.intTelecomObtenida).format("d-MM-YY")+'' };
}},
          ],
        });
      });

    </script>
    <%}%>
</body>

</html>