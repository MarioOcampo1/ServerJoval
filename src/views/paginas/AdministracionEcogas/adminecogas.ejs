<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" <!-- Datatable
    -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/jszip-2.5.0/dt-1.11.4/af-2.3.7/b-2.2.2/b-colvis-2.2.2/b-html5-2.2.2/b-print-2.2.2/cr-1.5.5/date-1.1.2/fc-4.0.2/fh-3.2.2/kt-2.6.4/r-2.2.9/rg-1.1.4/rr-1.2.8/sc-2.0.5/sb-1.3.1/sp-1.4.0/sl-1.3.4/sr-1.1.0/datatables.min.css"/>
 
 

  <title class="text-center">Administración Ecogas</title>
</head>

<body>
   <%- include('./partials/menusuperior.ejs');%>
   <%if(results){%>
   <div class="container">
    <div class="row">
      <h1 class="text-center">Administración de obras de Gas</h1>
    </div>
   
  </div>
  <div class="container text-center">
  <div class="btn-group mr-2" role="group">
    <a href="/">
      <button class="btn btn-danger" onClick="history.go(-1);">Volver</button>
    </a>
    <a href="/nuevocliente">
      <button class="btn btn-success">Nuevo Cliente</button>
    </a>
  </div>
    <br>

  <div class="table">
    <table id="comunicacionDiaria" class="table table-striped table-bordered table-sm table-hover " style="width: 95%">
     
      <thead>

        <tr>
          <th>
            <h4>Nombre</h4>
          </th>
          <th>
            <h4>N° de carpeta</h4>
          </th>
          <th>
            <h4>Responsable</h4>
            <button id="Mauricio"class=" btn btn-dark p-2"> Mauricio</button>
            <button id="Gustavo"class="   btn btn-dark p-1"> Gustavo</button>
          </th>
          <th>
            <h4>Tarea realizada</h4>
      <button id="TablaGral"clicked class=" btn btn-dark p-1">Quitar filtros</button>
        
          </th>
          <th> <h4>Etapa de la tarea</h4>

           <button id="Prel"> Prel</button>

          </th>
          <th>
            <h4>Proxima tarea</h4>
          </th>
          <th>
            <h4>Fecha Limite</h4>
          </th>
          <th>
            <h4>Estado</h4>
          <!-- </th>
          <th>Opciones</th> -->
        </tr>
      </thead>
      <tbody>
      </tbody>
      
    </table>
  </div>
  <script type="text/javascript" language="javascript"
  src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script type="text/javascript" language="javascript" charset="utf8"
    src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
  <!-- <script type="text/javascript" language="javascript"
    src="//cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"></script> -->
  <!-- Moment.js: -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.4/moment.min.js"></script>
  <!-- Locales for moment.js-->
  <script type="text/javascript" src="//cdn.datatables.net/plug-ins/1.11.3/sorting/datetime-moment.js"></script>
  <script  type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.4/locale/es.js"></script>
  <!-- Datatable -->
  <script  type="text/javascript" src="https://cdn.datatables.net/datetime/1.1.1/css/dataTables.dateTime.min.css"></script>
  <script  type="text/javascript" src="https://cdn.datatables.net/datetime/1.1.1/js/dataTables.dateTime.min.js"></script>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs5/jszip-2.5.0/dt-1.11.4/af-2.3.7/b-2.2.2/b-colvis-2.2.2/b-html5-2.2.2/b-print-2.2.2/cr-1.5.5/date-1.1.2/fc-4.0.2/fh-3.2.2/kt-2.6.4/r-2.2.9/rg-1.1.4/rr-1.2.8/sc-2.0.5/sb-1.3.1/sp-1.4.0/sl-1.3.4/sr-1.1.0/datatables.min.js"></script>
  <script>  
  $(document).ready(function(){
   
      var url = '/adminecogas/TablaGeneral';
      
    var tabla= $('#comunicacionDiaria').DataTable({
        orderCellsTop: true,
        fixedHeader: true,
      paging: false,
        "language": { url: "//cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json" },
        "ajax": {
          "url": url,
          "dataSrc": "",
        },
       
        "columns": [
          { "width":"5%","data": "Nombre_sub", render: function(data,type,row){
            return '<a href="/editarTareas/' + row.id + '" class="btn btn-outline-secondary btn-sm">'+row.Nombre_sub+'</a>'
          } },
          { "width":"5%","data": "NCarpeta", render: function(data,type,row){
            return '<a href="/editarTareas/' + row.id + '" class="btn btn-outline text-center btn-sm">'+row.NCarpeta+'</a>'
          } },
          { "width":"5%","data": "ResponsableDeTarea"},
          { "width":"70%","searchable":false,"data": "Tarea_Realizada_sub" }, 

          { "data": "EtapaTarea_sub", render: function(data,type,row){return '<a href="/historialcarpeta/' + row.Nombre_sub + '" class="btn btn-secondary btn-sm text-center">'+row.EtapaTarea_sub+'</a>'} }, //Esta es lo correcto que deberia de ir en esta linea
          
          { "width":"15%", "searchable":false,"data": "Proxima_Tarea_sub" },
          
          { "width":"5%","data":  "Fecha_Proxima_Tarea_sub", render:function(data,type,row){
            var oldDate = data;
            var fechaActual = new Date();

            fechaActual = fechaActual.toISOString();
       
    momentObj = moment(oldDate).format("d-MMMM-YYYY"),
    newDate = momentObj;
    if (fechaActual>oldDate){
         return '<div class="bg-danger text-dark">'+ newDate+' </div>'
    }
    else{
        return newDate;
    }
           }},      
          { "width":"10%","data": "Estado" },

        ],
        destroy:true,
      });

//Buscadores con botones.
   $('#Mauricio').on('click', function() {
    tabla
    .column(2)
    .search('Mauricio')
    .draw();
  });
    $('#Gustavo').on('click', function() {
    tabla
    .column(2)
    .search('Gustavo')
    .draw();
});
$('#TablaGral').on('click', function() {
    tabla
    .columns()
    .search('')
    .draw();
});
  })
     </script>
<%}%>
</body>

</html>