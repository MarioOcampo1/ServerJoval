<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Administración General</title>
    <link rel="stylesheet" href="../assets/css/Joval.css">
</head>
<body>
    <%- include('../partials/menusuperior.ejs'); %>
    <h1 class="text-center">Albacaución</h1>
    <%- include('../partials/albacaucion/NuevaPolizaAlbacaucion.ejs'); %> <!-- Opcion para cargar la nueva póliza de albacaución -->
    <div class="btn-group m-1" role="group" aria-label="Botones">
        <button type="button" class="btn btn-danger" onclick="document.getElementById('nuevaPoliza').style.display='block';">Nueva póliza</button>
    </div>    
    <div class="div p-1">
        <label for="Buscador">Buscador de tabla</label>
        <input type="text" name="Buscador" id="BuscadorTabla">
    </div>
    <div class="table-bordered p-1 text-center">
       <table id="tablaAlbacaucion" class="table-bordered p-1 text-center">
        <thead>
            <tr>
    <th scope="col">N° póliza</th>
    <th scope="col">Emisión</th>
    <th scope="col">Vigencia</th>
    <th scope="col">Riesgo</th>
    <th scope="col">Valor a pagar</th>
    <th scope="col">Monto asegurado</th>
    <th scope="col">Obra</th>
    <th scope="col">Proxima refacturación</th>
    <th scope="col">Nombre Asegurado</th>
    <th scope="col">Estado</th>
  </tr>
</thead>
<%results.forEach((poliza)=>{%>
    <%var Fecha = Date.now();%>
   
<tbody>
    <tr>
   <%if(poliza.Estado=='Dada de baja'){} else{    %>
        <td><%=poliza.NumeroPoliza%></td>
        <td><%=moment(poliza.FechaEmisionPoliza).format('DD/MM/YYYY')%> </td>
        <td><%=poliza.VigenciaPoliza%></td>
        <td><%=poliza.Riesgo%></td>
        <td><%=poliza.Valor%></td>
        <td><%=poliza.MontoAsegurado%></td>
        <td><%=poliza.Obra%></td>
        <%if(((poliza.ProximaRefacturacion- Fecha)>30) && poliza.Estado!="Dada de baja"){%>
        <td class="bg-danger text-white"><%=moment(poliza.ProximaRefacturacion).format('DD/MM/YYYY')%> </td>
        <%}else{%>
            <td ><%=moment(poliza.ProximaRefacturacion).format('DD/MM/YYYY')%> </td>
            <%}%>
        <td><%=poliza.NombreAsegurado%></td>
        <td><%=poliza.Estado%>
            
            <a href="ActualizarPolizaAlbacaucion/<%=poliza.ID_poliza%>">
        <button  class="btnEditar">Editar</button>
    </a>
        </td>
<%}%>
        <%})%>
  </tr>
</div>
</tbody>
</table>
</body>
<script>
   jQuery("#BuscadorTabla").keyup(function(){
    if( jQuery(this).val() != "0"){
        jQuery("#tablaAlbacaucion tbody>tr").hide();
        jQuery("#tablaAlbacaucion td:contiene-palabra('" + jQuery(this).val() + "')").parent("tr").show();
    }
    else{
        jQuery("#tablaAlbacaucion tbody>tr").show();
    }
});

jQuery.extend(jQuery.expr[":"], 
{
    "contiene-palabra": function(elem, i, match, array) {
        return (elem.textContent || elem.innerText || jQuery(elem).text() || "").toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
    }
});

</script>
</html>