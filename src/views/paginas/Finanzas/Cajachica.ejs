<!DOCTYPE html>
<html lang="en">

<head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caja chica</title>
    
</head>

<body>
    <%- include('./partials/menusuperior.ejs'); %>
        <h1 class="text-center">Caja chica</h1>
        <div class="container-fluid">
        <div class="btn-group " role="group">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalId">Nuevo Ingreso</button>
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalEgreso">Nuevo Egreso</button>
            
            
        </div>
        <div class="row mt-2 mb-2">
           
    <div class="col-4">
            <input class="form-control" list="datalistOptions" id="DatalistMeses" placeholder="Búsqueda por mes específico">
            <datalist id="datalistOptions">
                <option value="Enero">
                <option value="Febrero">
                <option value="Marzo">
                <option value="Abril">
                <option value="Mayo">
                <option value="Junio">
                <option value="Julio">
                <option value="Agosto">
                <option value="Septiembre">
                <option value="Octubre">
                <option value="Noviembre">
                <option value="Diciembre">
            </datalist>
           
        </div>
        <div id="BalanceDeCaja" class="col-auto border">
        Balance de caja: 
    </div>
        </div>
        <div class="row">
        <div class="col-6">
            <div class="table-responsive">
                <table class="table table-success">
                    <thead>
                        <tr>
                            <th colspan="4" class="text-center">Ingreso</th> 
                        </tr>
                        <tr>
                            <th  scope="col">Fecha</th>
                            <th  scope="col">Descripción</th>
                            <th  scope="col">$</th>
                        <th> Opciones</th>
                        </tr>
                    </thead>
                    <tbody>
                         <%finanzas.forEach((Ingreso)=>{%>
                                <tr class="">     
                                    <%if(Ingreso.Tipo=="Ingreso"){%>         
                                    
                                <td><%= moment(Ingreso.Fecha).locale('es').format("DD-MM-YYYY")%></td>
                                <td><%= Ingreso.Descripcion%></td>
                                <td><%= Ingreso.Monto%></td>
                                <td><button  class="bi bi-pencil-square btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#modalEditarRegistro" onclick="abrirModalEditarRegistro('<%=Ingreso.id%>', 'Ingreso','<%=Ingreso.Fecha%>','<%=Ingreso.Descripcion%>','<%=Ingreso.Monto%>')"></button></td>
                            </tr>
                                <%}})%>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-6">
            <div class="table-responsive">
                <table class="table table-danger">
                    <thead>
                        <tr>
                            <th colspan="4" class="text-center">Egreso</th>
                        </tr>
                        <tr>
                            <th  scope="col">Fecha</th>
                            <th  scope="col">Descripción</th>
                            <th  scope="col">$</th>
                            <th> Opciones</th>
                        </tr>
                    </thead>
                    <tbody>
                       
                            <%finanzas.forEach((Egreso)=>{%>
                                <tr class="">
                               <%if(Egreso.Tipo=="Egreso"){%> 
                                <td><%= moment(Egreso.Fecha).locale('es').format("DD-MM-YYYY")%></td>
                                <td><%= Egreso.Descripcion%></td>
                                <td><%= Egreso.Monto%></td>
                                <td><button value="<%=Egreso.id%>" class="bi bi-pencil-square btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#modalEditarRegistro" onclick="abrirModalEditarRegistro('<%=Egreso.id%>', 'Egreso','<%=Egreso.Fecha%>','<%=Egreso.Descripcion%>','<%=Egreso.Monto%>')"></button></td>
                            </tr>
                                <%}})%>
                      
                       
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>
    <%- include('./partials/CajaChica/Ingreso.ejs'); %>   
    <%- include('./partials/CajaChica/Egreso.ejs'); %>     
    <%- include('./partials/CajaChica/EditarRegistro.ejs'); %>    
    </div>

</body>
<script>
    function abrirModalEditarRegistro(id,IngresoEgreso, fecha, descripcion, monto){
        $('#idEditarRegistro').val(id);
$('#IngresoEgreso').val(IngresoEgreso);

    $('#EdicionFecha').val(fecha);
$('#EdicionDescripcion').val(descripcion);
$('#EdicionMonto').val(monto);
    }
    $(function () {
        $.ajax({
        type: "GET",
        url: "/Finanzas_CajaChica/data",
                dataType: "JSON",
        success: function (response) {
            console.log(response);
            var BalanceDeCaja=0;
            response.forEach(element => {
                if(element.Tipo=="Ingreso"){
                    BalanceDeCaja=BalanceDeCaja+ element.Monto;
                }else{
                    BalanceDeCaja= BalanceDeCaja-element.Monto;
                }

                
            });
            $('#BalanceDeCaja').append(BalanceDeCaja); 
        }
    }); 
    });
  
</script>
</html>